trim(
    if(
        contains(body('Html_to_text'),'Catálogo:'),
        first(split(skip(split(body('Html_to_text'),'Catálogo:'),1),'\n')),
        ''
    )
)


trim(
  if(
    greaterOrEquals(
      indexOf(replace(outputs('Html_to_text')?['body'], '\r\n','\n'), 'Catálogo:'),
      0
    ),
    first(
      split(
        // trozo de texto que viene después de "Catálogo:"
        substring(
          replace(outputs('Html_to_text')?['body'], '\r\n','\n'),
          add(
            indexOf(replace(outputs('Html_to_text')?['body'], '\r\n','\n'), 'Catálogo:'),
            length('Catálogo:')
          ),
          4000
        ),
        '\n'
      )
    ),
    'N/A'   // valor por defecto si no se encuentra
  )
)

trim(
  first(
    split(
      last(
        split(variables('Cuerpo'), 'DETALLES TÉCNICOS')
      ),
      '\n\n\n \n\n'
    )
  )
)




trim(
  replace(
    replace(
      first(
        split(
          last(
            split(
              replace(variables('Cuerpo'), '\r\n','\n'),
              'DETALLES TÉCNICOS:'
            )
          ),
          '\n\n\n\n\n'           // corta antes del bloque de 5 \n (donde empieza "Puede...")
        )
      ),
      ':\n\n',''                  // elimina ":\n\n" si aparece al inicio
    ),
    '\n\n',''                     // y limpia un doble \n inicial si quedara
  )
)

substring(variables('Peticion'), 0, indexOf(variables('Peticion'), 'Puede ver'))

substring(variables('Peticion'), indexOf(variables('Peticion'), 'Detalles Técnicos'), length(variables('Peticion')))

replace(variables('Notificacion'), '\n', decodeUriComponent('%0A'))

{
  "type": "TextBlock",
  "text": "@{replace(variables('Notificacion'), '\n', '\n\n')}",
  "wrap": true
}




