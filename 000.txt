

index="ise-cloud-cdossi" sourcetype="cisco:esa"

* Determinar si es IN o OUT según el valor de cs1 *
| eval direction = case(
        like(cs1, "%IN%"), "IN",
        like(cs1, "%OUT%"), "OUT",
        true(), "UNKNOWN"
    )

* Elegir el dominio correcto según IN/OUT *
| eval domain = case(
        direction="OUT", src_domain,
        direction="IN", recipient_domain,
        true(), null()
    )

* Contadores *
| eval IN = if(direction="IN", 1, 0)
| eval OUT = if(direction="OUT", 1, 0)

* Agrupación final *
| stats sum(IN) as IN sum(OUT) as OUT by domain

| sort domain