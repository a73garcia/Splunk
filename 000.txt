@{concat('| ', item()?['Cluster'], ' | ', item()?['Node'], ' | ', item()?['Info'], ' | ', item()?['User'], ' | ', item()?['Data'], ' |\n')}

ğŸ“Š **CES Audit â€“ Registros actuales**
Lista completa del archivo CES Audit (hoja Users):

| Cluster | Node | Info | User | Data |
|----------|------|------|------|------|
@{variables('TEXTO')}

=IZQUIERDA(G1;HALLAR("ab._";G1)+3)&C1&DERECHA(G1;LARGO(G1)-HALLAR(". IN";G1)+1)


substring(outputs('NombreDeTuAcciÃ³n'), indexOf(outputs('NombreDeTuAcciÃ³n'), 'BLACKLIST MONITORING CHANGES DETECTED'), sub(indexOf(outputs('NombreDeTuAcciÃ³n'), '*Note:'), indexOf(outputs('NombreDeTuAcciÃ³n'), 'BLACKLIST MONITORING CHANGES DETECTED')))

-------
replace(variables('LIMPIO'), '\[[^\]]*\]\([^)]+\)', '')

replace(variables('LIMPIO'), '\[[^\]]*\]', '')


replace(variables('LIMPIO'), '\n', decodeUriComponent('%0A'))

replace(variables('LIMPIO'), '\n', '<br>')



-----


ğŸ“Š **CES Audit â€“ Registros agrupados por Cluster**

@{join(
  union(
    select(
      body('Enu_TABLA'),
      concat(
        'ğŸŸ¢ **',
        item()?['Cluster'],
        '**',
        '\n| Node | Info | User | Data |',
        '\n|------|------|------|------|',
        '\n| ',
        item()?['Node'],
        ' | ',
        item()?['Info'],
        ' | ',
        item()?['User'],
        ' | ',
        item()?['Data'],
        ' |'
      )
    ),
    createArray('')
  ),
  '\n\n'
)}













{
  "type": "AdaptiveCard",
  "body": [
    {
      "type": "Container",
      "items": [
        {
          "type": "TextBlock",
          "text": "ğŸš¨ NUEVA INCIDENCIA DETECTADA",
          "weight": "Bolder",
          "size": "Large",
          "color": "Attention",
          "horizontalAlignment": "Center"
        },
        {
          "type": "TextBlock",
          "text": "Detalles del evento:",
          "weight": "Bolder",
          "spacing": "Medium"
        },
        {
          "type": "FactSet",
          "facts": [
            {
              "title": "ğŸ†” ID CorrelaciÃ³n:",
              "value": "@{variables('IDCORRELACION')}"
            },
            {
              "title": "ğŸ“‹ INC:",
              "value": "@{variables('INC')}"
            },
            {
              "title": "âš ï¸ Alerta:",
              "value": "@{variables('ALERTA')}"
            },
            {
              "title": "ğŸ”¥ Prioridad:",
              "value": "@{variables('PRIORIDAD')}"
            }
          ]
        },
        {
          "type": "TextBlock",
          "text": "â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€",
          "color": "Accent",
          "spacing": "Medium"
        },
        {
          "type": "TextBlock",
          "text": "ğŸ•’ NotificaciÃ³n generada automÃ¡ticamente por Power Automate",
          "isSubtle": true,
          "size": "Small",
          "horizontalAlignment": "Center"
        }
      ]
    }
  ],
  "$schema": "http://adaptivecards.io/schemas/adaptive-card.json",
  "version": "1.4"
}


ğŸš¨ **Nueva incidencia detectada** ğŸš¨  

**ğŸ†” ID CorrelaciÃ³n:** `@{variables('IDCORRELACION')}`  
**ğŸ“‹ INC:** `@{variables('INC')}`  
**âš ï¸ Alerta:** `@{variables('ALERTA')}`  
**ğŸ”¥ Prioridad:** `@{variables('PRIORIDAD')}`  

â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  
ğŸ•’ *NotificaciÃ³n generada automÃ¡ticamente por Power Automate*

trim(
    replace(
        replace(
            split(variables('EstVarDatos'), '</td>')[3],
            '<td>',
            ''
        ),
        '</td>',
        ''
    )
)
